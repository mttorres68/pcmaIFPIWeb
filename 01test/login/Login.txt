import { Button } from "@material-tailwind/react"
import axios from "axios";
import { Navigate, useNavigate } from "react-router-dom";

import { useEffect, useState } from "react";
import { Input } from "../../components/Input"

export const Login = () =>{

    const [matricula,setMatricula ] = useState("");
    const [senha,setSenha ] = useState("");
    const [error, setError] = useState("");
    const navigate = useNavigate();
    let _itoken = []

    const handleSubmit = async (event) => {
        event.preventDefault();
        const formData = new FormData(event.target)
        const data = Object.fromEntries(formData);

        if(!matricula | !senha){
            setError("Preencha todos os campos!");
            return;
        }

        try{
            let response = await axios.post('http://localhost:3000/login', {
                matricula: data.matricula,
                senha: Number(data.senha),
            })
            if(response){
                console.log(response.data);
                navigate("/Home");
                for(let e of response.data){
                    _itoken.push(e.itoken)
                }
            }else{
                alert('Usuario n√£o cadastrado')
            }
        }catch(err){
            console.log(err,'err');
        }

    }

    return (
        <>
            <main className="md:grid md:grid-cols-1 grid-cols-1 h-full relative">
                <section className="mx-auto max-w-6xl py-20 px-12 lg:px-24 mb-24">
                    <h1 className="block uppercase tracking-wide text-white font-bold text-lg mb-5 text-center">Acessar Conta</h1>
                    <hr className="m-2 border-b-1 "/>
                    <form action="" onSubmit={handleSubmit} >
                            <label
                                htmlFor='matricula'
                                className="block uppercase tracking-wide text-white text-xs font-bold mb-2"
                            >
                            Matricula
                            </label>
                            <input
                                
                                name="matricula"
                                placeholder="2022123tads18"
                                value={matricula}
                                onChange={e => [setMatricula(e.target.value), setError('')]}
                                className="w-full bg-white-200 text-black border-2 border-gray-400 rounded-lg py-3 px-8 mb-2 focus:outline-none focus:ring-2 focus:ring-offset-black focus:border-transparent hover:bg-blue-gray-100 placeholder-blue-gray-900"
                            />
                            <label
                                htmlFor='senha'
                                className="block uppercase tracking-wide text-white text-xs font-bold mb-2"
                            >
                            Senha
                            </label>
                            <input
                                type='password'
                                name="senha"
                                placeholder="******"
                                value={senha}
                                onChange={e => setSenha(e.target.value)}
                                className="w-full bg-white-200 text-black border-2 border-gray-400 rounded-lg py-3 px-8 mb-2 focus:outline-none focus:ring-2 focus:ring-offset-black focus:border-transparent hover:bg-blue-gray-100 placeholder-blue-gray-900"
                            />
                        <div className="text-center text-red-700 font-serif m-2 " >
                            <label htmlFor="">
                                {error}
                            </label>
                        </div>
                        <div  className="text-center">
                        <Button
                            color="indigo"
                            type="submit"
                            variant="grandiente"
                            value="entrar"
                        >
                            Entrar
                        </Button>
                        </div>
                    </form>
                </section>
            </main>

            
        </>
    )
}